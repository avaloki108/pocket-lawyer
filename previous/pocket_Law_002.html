<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pocket Lawyer - Your Legal Companion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4B4ABF'
                    }
                }
            }
        }
    </script>
    <style>
        .fade-in { opacity: 0; animation: fadeIn 0.3s forwards; }
        @keyframes fadeIn { to { opacity: 1; } }
        .slide-up { transform: translateY(20px); opacity: 0; animation: slideUp 0.4s forwards; }
        @keyframes slideUp { to { transform: translateY(0); opacity: 1; } }
        .chat-message { max-width: 85%; word-wrap: break-word; }
        .typing-indicator { 
            display: flex; 
            align-items: center; 
            padding: 12px 16px; 
            background: #f3f4f6; 
            border-radius: 18px; 
            margin: 8px 0;
            max-width: 80px;
        }
        .typing-indicator span {
            height: 8px;
            width: 8px;
            background: #9ca3af;
            border-radius: 50%;
            display: inline-block;
            margin: 0 1px;
            animation: typing 1.4s infinite ease-in-out;
        }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }
        .dark .typing-indicator { background: #374151; }
        .dark .typing-indicator span { background: #6b7280; }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 min-h-screen">
    <!-- Dark mode detection -->
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>

    <div class="max-w-md mx-auto bg-white dark:bg-gray-900 min-h-screen">
        <!-- Header -->
        <header class="bg-primary text-white p-4 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="w-8 h-8 bg-white rounded-full flex items-center justify-center">
                    <span class="text-primary font-bold text-sm">‚öñÔ∏è</span>
                </div>
                <div>
                    <h1 class="font-bold text-lg">Pocket Lawyer</h1>
                    <p class="text-xs opacity-90" id="stateDisplay">California</p>
                </div>
            </div>
            <button id="settingsBtn" class="p-2 hover:bg-primary-dark rounded-lg transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
            </button>
        </header>

        <!-- Chat Screen -->
        <div id="chatScreen" class="screen active pb-24 pt-4">
            <div class="p-4">
                <!-- Welcome Message -->
                <div class="bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 rounded-lg p-4 mb-4">
                    <div class="flex items-start space-x-3">
                        <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
                            <span class="text-white text-sm">‚öñÔ∏è</span>
                        </div>
                        <div>
                            <h3 class="font-semibold text-blue-900 dark:text-blue-100 mb-1">Welcome to Pocket Lawyer!</h3>
                            <p class="text-sm text-blue-800 dark:text-blue-200">I provide legal information (not advice) specific to your state. Ask me about laws, rights, or legal processes in plain English.</p>
                        </div>
                    </div>
                </div>

                <!-- Legal Disclaimer -->
                <div class="bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-700 rounded-lg p-3 mb-4">
                    <p class="text-xs text-yellow-800 dark:text-yellow-200">
                        ‚ö†Ô∏è <strong>Important:</strong> This provides legal information, not legal advice. For specific legal matters, consult a licensed attorney.
                    </p>
                </div>
            </div>

            <!-- Chat Messages -->
            <div id="chatMessages" class="px-4 space-y-4 mb-4">
                <!-- Messages will be added here -->
            </div>

            <!-- Chat Input -->
            <div class="fixed bottom-20 left-1/2 transform -translate-x-1/2 w-full max-w-md p-4 bg-white dark:bg-gray-900">
                <div class="flex space-x-2">
                    <input 
                        type="text" 
                        id="chatInput" 
                        placeholder="Ask about laws in your state..." 
                        class="flex-1 p-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent"
                    >
                    <button 
                        id="sendBtn" 
                        class="px-4 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
                    >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Prompts Screen -->
        <div id="promptsScreen" class="screen hidden pb-24 pt-4">
            <div class="p-4">
                <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">What do you need help with?</h2>
                
                <div class="space-y-4">
                    <!-- Employment Law -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden">
                        <button class="category-btn w-full p-4 text-left flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700" data-category="employment">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center">
                                    <span class="text-blue-600 dark:text-blue-400">üíº</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-900 dark:text-white">Employment Law</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Workplace rights, wages, discrimination</p>
                                </div>
                            </div>
                            <svg class="w-5 h-5 text-gray-400 transform transition-transform category-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="category-content hidden p-4 pt-0 space-y-2">
                            <button class="prompt-btn w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded border border-gray-100 dark:border-gray-600" data-prompt="What are my rights if I'm fired without cause in [STATE]?">
                                What are my rights if I'm fired without cause?
                            </button>
                            <button class="prompt-btn w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded border border-gray-100 dark:border-gray-600" data-prompt="What is the minimum wage in [STATE] and what are the overtime requirements?">
                                Minimum wage and overtime requirements
                            </button>
                            <button class="prompt-btn w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded border border-gray-100 dark:border-gray-600" data-prompt="How do I report workplace discrimination or harassment in [STATE]?">
                                Reporting workplace discrimination
                            </button>
                        </div>
                    </div>

                    <!-- Real Estate -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden">
                        <button class="category-btn w-full p-4 text-left flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700" data-category="realestate">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center">
                                    <span class="text-green-600 dark:text-green-400">üè†</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-900 dark:text-white">Real Estate</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Tenant rights, property laws, landlord issues</p>
                                </div>
                            </div>
                            <svg class="w-5 h-5 text-gray-400 transform transition-transform category-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="category-content hidden p-4 pt-0 space-y-2">
                            <button class="prompt-btn w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded border border-gray-100 dark:border-gray-600" data-prompt="What are tenant rights regarding security deposits in [STATE]?">
                                Security deposit rights
                            </button>
                            <button class="prompt-btn w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded border border-gray-100 dark:border-gray-600" data-prompt="How much notice must a landlord give before eviction in [STATE]?">
                                Eviction notice requirements
                            </button>
                            <button class="prompt-btn w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded border border-gray-100 dark:border-gray-600" data-prompt="What repairs is a landlord required to make in [STATE]?">
                                Landlord repair obligations
                            </button>
                        </div>
                    </div>

                    <!-- Criminal & Traffic -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden">
                        <button class="category-btn w-full p-4 text-left flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700" data-category="criminal">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-red-100 dark:bg-red-900 rounded-lg flex items-center justify-center">
                                    <span class="text-red-600 dark:text-red-400">üöó</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-900 dark:text-white">Criminal & Traffic</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Tickets, violations, court procedures</p>
                                </div>
                            </div>
                            <svg class="w-5 h-5 text-gray-400 transform transition-transform category-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="category-content hidden p-4 pt-0 space-y-2">
                            <button class="prompt-btn w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded border border-gray-100 dark:border-gray-600" data-prompt="What is the legal process for fighting a speeding ticket in [STATE]?">
                                Fighting a speeding ticket
                            </button>
                            <button class="prompt-btn w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded border border-gray-100 dark:border-gray-600" data-prompt="What are my rights during a police traffic stop in [STATE]?">
                                Rights during traffic stops
                            </button>
                            <button class="prompt-btn w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded border border-gray-100 dark:border-gray-600" data-prompt="What happens if I miss my court date in [STATE]?">
                                Missing court dates
                            </button>
                        </div>
                    </div>

                    <!-- Family & Personal -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden">
                        <button class="category-btn w-full p-4 text-left flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700" data-category="family">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center">
                                    <span class="text-purple-600 dark:text-purple-400">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-900 dark:text-white">Family & Personal</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Divorce, custody, wills, personal rights</p>
                                </div>
                            </div>
                            <svg class="w-5 h-5 text-gray-400 transform transition-transform category-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="category-content hidden p-4 pt-0 space-y-2">
                            <button class="prompt-btn w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded border border-gray-100 dark:border-gray-600" data-prompt="What is the process for filing for divorce in [STATE]?">
                                Filing for divorce
                            </button>
                            <button class="prompt-btn w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded border border-gray-100 dark:border-gray-600" data-prompt="Do I need a lawyer to write a will in [STATE]?">
                                Writing a will
                            </button>
                            <button class="prompt-btn w-full text-left p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded border border-gray-100 dark:border-gray-600" data-prompt="What are grandparent visitation rights in [STATE]?">
                                Grandparent rights
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Screen -->
        <div id="settingsScreen" class="screen hidden pb-24 pt-4">
            <div class="p-4">
                <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-6">Profile & Settings</h2>
                
                <!-- Profile Section -->
                <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 mb-4">
                    <h3 class="font-semibold text-gray-900 dark:text-white mb-4">Profile Information</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Primary State</label>
                            <select id="stateSelect" class="w-full p-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                <option value="AL">Alabama</option>
                                <option value="AK">Alaska</option>
                                <option value="AZ">Arizona</option>
                                <option value="AR">Arkansas</option>
                                <option value="CA" selected>California</option>
                                <option value="CO">Colorado</option>
                                <option value="CT">Connecticut</option>
                                <option value="DE">Delaware</option>
                                <option value="FL">Florida</option>
                                <option value="GA">Georgia</option>
                                <option value="HI">Hawaii</option>
                                <option value="ID">Idaho</option>
                                <option value="IL">Illinois</option>
                                <option value="IN">Indiana</option>
                                <option value="IA">Iowa</option>
                                <option value="KS">Kansas</option>
                                <option value="KY">Kentucky</option>
                                <option value="LA">Louisiana</option>
                                <option value="ME">Maine</option>
                                <option value="MD">Maryland</option>
                                <option value="MA">Massachusetts</option>
                                <option value="MI">Michigan</option>
                                <option value="MN">Minnesota</option>
                                <option value="MS">Mississippi</option>
                                <option value="MO">Missouri</option>
                                <option value="MT">Montana</option>
                                <option value="NE">Nebraska</option>
                                <option value="NV">Nevada</option>
                                <option value="NH">New Hampshire</option>
                                <option value="NJ">New Jersey</option>
                                <option value="NM">New Mexico</option>
                                <option value="NY">New York</option>
                                <option value="NC">North Carolina</option>
                                <option value="ND">North Dakota</option>
                                <option value="OH">Ohio</option>
                                <option value="OK">Oklahoma</option>
                                <option value="OR">Oregon</option>
                                <option value="PA">Pennsylvania</option>
                                <option value="RI">Rhode Island</option>
                                <option value="SC">South Carolina</option>
                                <option value="SD">South Dakota</option>
                                <option value="TN">Tennessee</option>
                                <option value="TX">Texas</option>
                                <option value="UT">Utah</option>
                                <option value="VT">Vermont</option>
                                <option value="VA">Virginia</option>
                                <option value="WA">Washington</option>
                                <option value="WV">West Virginia</option>
                                <option value="WI">Wisconsin</option>
                
<option value="WY">Wyoming</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Subscription Section -->
                <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 mb-4">
                    <h3 class="font-semibold text-gray-900 dark:text-white mb-4">Subscription</h3>
                    
                    <div class="bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-700 rounded-lg p-4 mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                            </div>
                            <div>
                                <p class="font-semibold text-green-800 dark:text-green-200">Free Trial Active</p>
                                <p class="text-sm text-green-600 dark:text-green-300">2 days remaining</p>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-3">
                        <div class="border border-gray-200 dark:border-gray-600 rounded-lg p-4">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-semibold text-gray-900 dark:text-white">Monthly Plan</h4>
                                <span class="text-lg font-bold text-primary">$15/mo</span>
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Full access to all legal information</p>
                            <button class="w-full px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors">
                                Choose Plan
                            </button>
                        </div>

                        <div class="border-2 border-primary rounded-lg p-4 relative">
                            <div class="absolute -top-2 left-4 bg-primary text-white text-xs px-2 py-1 rounded">POPULAR</div>
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-semibold text-gray-900 dark:text-white">Annual Plan</h4>
                                <div class="text-right">
                                    <span class="text-lg font-bold text-primary">$180/yr</span>
                                    <p class="text-xs text-green-600">Save 20%</p>
                                </div>
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Best value for regular users</p>
                            <button class="w-full px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors">
                                Choose Plan
                            </button>
                        </div>

                        <div class="border border-gray-200 dark:border-gray-600 rounded-lg p-4">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-semibold text-gray-900 dark:text-white">1-Week Pass</h4>
                                <span class="text-lg font-bold text-primary">$8</span>
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Perfect for short-term needs</p>
                            <button class="w-full px-4 py-2 border border-primary text-primary rounded-lg hover:bg-primary hover:text-white transition-colors">
                                Choose Plan
                            </button>
                        </div>
                    </div>
                </div>

                <!-- About Section -->
                <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4">
                    <h3 class="font-semibold text-gray-900 dark:text-white mb-3">About</h3>
                    <div class="space-y-2 text-sm text-gray-600 dark:text-gray-400">
                        <p>Version 1.0.0</p>
                        <button class="text-primary hover:underline">Terms of Service</button>
                        <button class="text-primary hover:underline">Privacy Policy</button>
                        <button class="text-primary hover:underline">Contact Support</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="fixed bottom-0 left-1/2 transform -translate-x-1/2 w-full max-w-md bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
            <!-- Screen Icons -->
            <div class="flex">
                <button class="nav-btn flex-1 p-3 text-center active" data-screen="chat">
                    <svg class="w-6 h-6 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                    </svg>
                    <span class="text-xs">Chat</span>
                </button>
                <button class="nav-btn flex-1 p-3 text-center" data-screen="prompts">
                    <svg class="w-6 h-6 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                    </svg>
                    <span class="text-xs">Prompts</span>
                </button>
                <button class="nav-btn flex-1 p-3 text-center" data-screen="settings">
                    <svg class="w-6 h-6 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    <span class="text-xs">Profile</span>
                </button>
            </div>
            
            <!-- Navigation Dots -->
            <div class="flex justify-center pb-2 pt-1">
                <div class="flex space-x-2">
                    <div class="nav-dot w-2 h-2 rounded-full bg-primary transition-all duration-200" data-screen="chat"></div>
                    <div class="nav-dot w-2 h-2 rounded-full bg-gray-300 dark:bg-gray-600 transition-all duration-200" data-screen="prompts"></div>
                    <div class="nav-dot w-2 h-2 rounded-full bg-gray-300 dark:bg-gray-600 transition-all duration-200" data-screen="settings"></div>
                </div>
            </div>
        </nav>
    </div>

    <script>
        // State management
        let currentState = 'California';
        const stateMapping = {
            'AL': 'Alabama', 'AK': 'Alaska', 'AZ': 'Arizona', 'AR': 'Arkansas', 'CA': 'California',
            'CO': 'Colorado', 'CT': 'Connecticut', 'DE': 'Delaware', 'FL': 'Florida', 'GA': 'Georgia',
            'HI': 'Hawaii', 'ID': 'Idaho', 'IL': 'Illinois', 'IN': 'Indiana', 'IA': 'Iowa',
            'KS': 'Kansas', 'KY': 'Kentucky', 'LA': 'Louisiana', 'ME': 'Maine', 'MD': 'Maryland',
            'MA': 'Massachusetts', 'MI': 'Michigan', 'MN': 'Minnesota', 'MS': 'Mississippi', 'MO': 'Missouri',
            'MT': 'Montana', 'NE': 'Nebraska', 'NV': 'Nevada', 'NH': 'New Hampshire', 'NJ': 'New Jersey',
            'NM': 'New Mexico', 'NY': 'New York', 'NC': 'North Carolina', 'ND': 'North Dakota', 'OH': 'Ohio',
            'OK': 'Oklahoma', 'OR': 'Oregon', 'PA': 'Pennsylvania', 'RI': 'Rhode Island', 'SC': 'South Carolina',
            'SD': 'South Dakota', 'TN': 'Tennessee', 'TX': 'Texas', 'UT': 'Utah', 'VT': 'Vermont',
            'VA': 'Virginia', 'WA': 'Washington', 'WV': 'West Virginia', 'WI': 'Wisconsin', 'WY': 'Wyoming'
        };

        // Navigation
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const targetScreen = btn.dataset.screen;
                showScreen(targetScreen);
                updateNavigation(targetScreen);
            });
        });

        function showScreen(screenName) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
                screen.classList.add('hidden');
            });
            
            const targetScreen = document.getElementById(screenName + 'Screen');
            if (targetScreen) {
                targetScreen.classList.remove('hidden');
                targetScreen.classList.add('active', 'fade-in');
            }
        }

        function updateNavigation(activeScreen) {
            // Update nav buttons
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active', 'text-primary'));
            document.querySelector(`[data-screen="${activeScreen}"]`).classList.add('active', 'text-primary');
            
            // Update nav dots
            document.querySelectorAll('.nav-dot').forEach(dot => {
                dot.classList.remove('bg-primary');
                dot.classList.add('bg-gray-300', 'dark:bg-gray-600');
            });
            document.querySelector(`.nav-dot[data-screen="${activeScreen}"]`).classList.remove('bg-gray-300', 'dark:bg-gray-600');
            document.querySelector(`.nav-dot[data-screen="${activeScreen}"]`).classList.add('bg-primary');
        }

        // State selection
        document.getElementById('stateSelect').addEventListener('change', (e) => {
            const stateCode = e.target.value;
            currentState = stateMapping[stateCode];
            document.getElementById('stateDisplay').textContent = currentState;
        });

        // Settings button
        document.getElementById('settingsBtn').addEventListener('click', () => {
            showScreen('settings');
            updateNavigation('settings');
        });

        // Category expansion
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const content = btn.nextElementSibling;
                const arrow = btn.querySelector('.category-arrow');
                
                if (content.classList.contains('hidden')) {
                    content.classList.remove('hidden');
                    content.classList.add('slide-up');
                    arrow.style.transform = 'rotate(180deg)';
                } else {
                    content.classList.add('hidden');
                    arrow.style.transform = 'rotate(0deg)';
                }
            });
        });

        // Prompt buttons
        document.querySelectorAll('.prompt-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const prompt = btn.dataset.prompt.replace('[STATE]', currentState);
                sendMessage(prompt);
                showScreen('chat');
                updateNavigation('chat');
            });
        });

        // Chat functionality
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');

        function addMessage(content, isUser = false, isTyping = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${isUser ? 'justify-end' : 'justify-start'} fade-in`;
            
            if (isTyping) {
                messageDiv.innerHTML = `
                    <div class="typing-indicator">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                `;
                messageDiv.id = 'typingIndicator';
            } else {
                const bgColor = isUser ? 'bg-primary text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white';
                const processedContent = isUser ? content : marked.parse(content);
                
                messageDiv.innerHTML = `
                    <div class="chat-message ${bgColor} rounded-lg px-4 py-3 max-w-xs md:max-w-sm lg:max-w-md">
                        ${isUser ? `<p class="text-sm">${content}</p>` : `<div class="text-sm prose prose-sm dark:prose-invert max-w-none">${processedContent}</div>`}
                    </div>
                `;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return messageDiv;
        }

        function removeTypingIndicator() {
            const typing = document.getElementById('typingIndicator');
            if (typing) typing.remove();
        }

        // Register handler for legal AI responses
        if (window.Poe && window.Poe.registerHandler) {
            window.Poe.registerHandler("legal-assistant", (result) => {
                removeTypingIndicator();
                
                const msg = result.responses[0];
                if (msg.status === "error") {
                    addMessage("Sorry, I encountered an error. Please try again.", false);
                } else if (msg.status === "incomplete") {
                    // Update with partial content while streaming
                    let existingResponse = document.querySelector('[data-message-id="' + msg.messageId + '"]');
                    if (!existingResponse) {
                        existingResponse = addMessage(msg.content, false);
                        existingResponse.setAttribute('data-message-id', msg.messageId);
                    } else {
                        const bgColor = 'bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white';
                        const processedContent = marked.parse(msg.content);
                        existingResponse.innerHTML = `
                            <div class="chat-message ${bgColor} rounded-lg px-4 py-3 max-w-xs md:max-w-sm lg:max-w-md">
                                <div class="text-sm prose prose-sm dark:prose-invert max-w-none">${processedContent}</div>
                            </div>
                        `;
                    }
                } else if (msg.status === "complete") {
                    // Update with final content
                    let existingResponse = document.querySelector('[data-message-id="' + msg.messageId + '"]');
                    if (!existingResponse) {
                        existingResponse = addMessage(msg.content, false);
                        existingResponse.setAttribute('data-message-id', msg.messageId);
                    } else {
                        const bgColor = 'bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white';
                        const processedContent = marked.parse(msg.content);
                        existingResponse.innerHTML = `
                            <div class="chat-message ${bgColor} rounded-lg px-4 py-3 max-w-xs md:max-w-sm lg:max-w-md">
                                <div class="text-sm prose prose-sm dark:prose-invert max-w-none">${processedContent}</div>
                            </div>
                        `;
                    }
                }
                
                chatMessages.scrollTop = chatMessages.scrollHeight;
            });
        }

        async function sendMessage(message = null) {
            const text = message || chatInput.value.trim();
            if (!text) return;

            // Add user message
            addMessage(text, true);
            if (!message) chatInput.value = '';

            // Show typing indicator
            addMessage('', false, true);

            // Disable send button
            sendBtn.disabled = true;

            try {
                if (window.Poe && window.Poe.sendUserMessage) {
                    const legalPrompt = `@Claude-Sonnet-4 You are a specialized legal information assistant for ${currentState}. 

IMPORTANT INSTRUCTIONS:
- Provide legal INFORMATION, never legal ADVICE
- Always specify this is for ${currentState} laws specifically
- Cite relevant statutes, codes, or regulations when possible
- Explain complex legal concepts in plain, friendly English
- Always include a disclaimer that this is information, not advice
- Recommend consulting a licensed attorney for specific legal matters
- If you don't know something specific to ${currentState}, say so clearly

User question: ${text}

Please provide a helpful, informative response specific to ${currentState} law in plain English.`;

                    await window.Poe.sendUserMessage(legalPrompt, {
                        handler: "legal-assistant",
                        stream: true,
                        openChat: false
                    });
                } else {
                    // Fallback for testing without Poe API
                    removeTypingIndicator();
                    setTimeout(() => {
                        addMessage(`**Legal Information for ${currentState}**\n\nI'd be happy to help explain the law in plain English! However, the Poe Embed API is not available in this environment. \n\n**Important:** This would provide legal information, not legal advice. For specific legal matters, please consult a licensed attorney in ${currentState}.\n\n*This is a demo of the Pocket Lawyer interface.*`, false);
                    }, 1000);
                }
            } catch (err) {
                removeTypingIndicator();
                addMessage("Sorry, I'm having trouble connecting right now. Please try again.", false);
                console.error('Error sending message:', err);
            } finally {
                sendBtn.disabled = false;
            }
        }

        // Event listeners
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        sendBtn.addEventListener('click', () => sendMessage());

        // Initialize with default nav state
        updateNavigation('chat');
    </script>
</body>
</html>